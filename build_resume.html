<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Build Your Resume</title>
    <link rel="stylesheet" href="css/styles.css">

  </head>
  <!-- ***********************  HEADER  ******************************** -->
  <header>
    <div>
        <div class="top">
            <img class="logo" src="img/earthLogoTransparent.png" alt="Logo">
        </div>
        <div class="head-nav">
            <ul>
                <li><a href="index.html"><span>Home</span></a></li>
                <li><a href="build_resume.html"><span>Build Resume</span></a></li>
                <li><a href="view_resume.html"><span>View Resume</span></a></li>
                <li><a href="resources.html"><span>Resources</span></a></li>
                <li><a href="donate.html"><span>Donate</span></a></li>
                <li><a href="contact.html"><span>Contact</span></a></li>
                <li><a href="about.html"><span>About</span></a></li>
            </ul>
        </div>
    </div>
  </header>

  <!-- ***********************  BODY  ******************************** -->

  <body>
    <h1>Build Your Resume Here</h1>
    <script language="javascript">
      var max_num_edu = 5;
      var max_num_exp = 7;
      var max_num_skill = 15;
      var max_num_interest = 10;

      var num_edu = 0;
      var num_exp = 0;
      var num_skill = 0;
      var num_interest = 0;

      window.onload = function()
      {
        addEdu();
        addExp();
        addSkill();
        addInterest();

        fill_form(); // Note: this function is only for testing purposes

        document.getElementById("add_edu").addEventListener("click", addEdu);
        document.getElementById("add_exp").addEventListener("click", addExp);
        document.getElementById("add_skill").addEventListener("click", addSkill);
        document.getElementById("add_interest").addEventListener("click", addInterest);
        document.getElementById("submit").addEventListener("click", submit);
      }

      //------------------ functions to add elements to the html ----------------------
      function addEdu()
      {
        if (num_edu == max_num_edu) {
          alert("Too many education experiences.");
          return;
        }

        var edu_item = document.createElement("DIV");
        edu_item.innerHTML = `
          <form name="edu${num_edu}">
            <label for="school_name">School Name: </label>
            <input type="text" id="school_name" name="school_name"><br/><br/>
            <label for="grad_date">Graduation Date: </label>
            <input type="date" id="grad_date" name="grad_date"/><br/><br/>
            <label for="description">Description: </label>
            <input type="text" id="description" name="description"><br/><br/>
            <label for="location">Location: </label>
            <input type="text" id="location" name="location"><br/><br/>
          </form><br/><br/>
        `;
        document.getElementById("edu").appendChild(edu_item);
        num_edu++;
      }

      function addExp()
      {
        if (num_exp == max_num_exp) {
          alert("Too many work experiences.");
          return;
        }

        var exp_item = document.createElement("DIV");
        exp_item.innerHTML = `
          <form name="exp${num_exp}">
            <label for="job_tile">Title: </label>
            <input type="text" id="job_title" name="job_title"><br/><br/>
            <label for="company">Company: </label>
            <input type="text" id="company" name="company"><br/><br/>
            <label for="location">Location: </label>
            <input type="text" id="location" name="location"><br/><br/>
            <label for="exp_start_date">Start Date: </label>
            <input type="date" id="exp_start_date" name="exp_start_date"/><br/><br/>
            <label for="exp_end_date">End Date: </label>
            <input type="date" id="exp_end_date" name="exp_end_date"/><br/><br/>
            <label for="description">Description: </label>
            <input type="text" id="description" name="description"><br/><br/>
          </form><br/><br/>
        `;
        document.getElementById("exp").appendChild(exp_item);
        num_exp++;
      }

      function addSkill()
      {
        if (num_skill == max_num_skill) {
          alert("Too many skills.");
          return;
        }

        var skill_item = document.createElement("DIV");
        skill_item.innerHTML = `
          <label for="skill${num_skill}">Skill: </label>
          <input type="text" id="skill${num_skill}" name="skill${num_skill}"><br/><br/>
        `;
        document.getElementById("skill").appendChild(skill_item);
        num_skill++;
      }

      function addInterest()
      {
        if (num_interest == max_num_interest) {
          alert("Too many interests.");
          return;
        }

        var interest_item = document.createElement("DIV");
        interest_item.innerHTML = `
          <label for="interest${num_interest}">Interest: </label>
          <input type="text" id="interest${num_interest}" name="interest${num_interest}"><br/><br/>
        `;
        document.getElementById("interest").appendChild(interest_item);
        num_interest++;
      }

      //------------------ functions to get values from the html ----------------------
      function getEducations(resume)
      {
        for (let i = 0; i < num_edu; i++) {
          if (validate_edu_form(i)) {
            // only non-empty forms are pushed
            if (document.forms[`edu${i}`]["school_name"].value != "") {
              var edu = {
                schoolName: document.forms[`edu${i}`]["school_name"].value,
                gradDate: document.forms[`edu${i}`]["grad_date"].value,
                description: document.forms[`edu${i}`]["description"].value,
                location: document.forms[`edu${i}`]["location"].value
              }
              resume["educations"].push(edu);
            }
          } else {
            alert("Every field in each education item has to be filled or leave the entire education item blank");
            return false;
          }
        }
        if (resume["educations"].length == 0) {
          alert("At least one education required.");
          return false;
        }
        return true;
      }

      function getExperiences(resume)
      {
        for (let i = 0; i < num_exp; i++) {
          if (validate_exp_form(i)) {
            if (document.forms[`exp${i}`]["job_title"].value != "") {
              var exp = {
                title: document.forms[`exp${i}`]["job_title"].value,
                company: document.forms[`exp${i}`]["company"].value,
                location: document.forms[`exp${i}`]["location"].value,
                startDate: document.forms[`exp${i}`]["exp_start_date"].value,
                endDate: document.forms[`exp${i}`]["exp_end_date"].value,
                description: document.forms[`exp${i}`]["description"].value
              }
              resume["experiences"].push(exp);
            }
          } else {
            alert("Every field in each experience item has to be filled or leave the entire experience item blank");
            return false;
          }
        }
        if (resume["experiences"].length == 0) {
          alert("At least one experiences required.");
          return false;
        }
        return true;
      }

      function getSkills(resume)
      {
        for (let i = 0; i < num_skill; i++) {
          if (document.getElementById(`skill${i}`).value != "") {
            resume["skills"].push(document.getElementById(`skill${i}`).value);
          }
        }
        if (resume["skills"].length == 0) {
          alert("At least one skill required.");
          return false;
        }
        return true;
      }

      function getInterests(resume)
      {
        for (let i = 0; i < num_interest; i++) {
          if (document.getElementById(`interest${i}`).value != "") {
            resume["interests"].push(document.getElementById(`interest${i}`).value);
          }
        }
        if (resume["interests"].length == 0) {
          alert("At least one interest required.");
          return false;
        }
        return true;
      }

      //------------------ functions to validate input values ----------------------

      function validate_info_form()
      {
        let form = document.forms["info"];
        return (form["fname"].value       != "" &&
                form["lname"].value       != "" &&
                form["addr"].value        != "" &&
                form["phone"].value       != "" &&
                form["email"].value       != "" &&
                form["linkedin"].value    != "" &&
                form["description"].value != "");
      }

      function validate_edu_form(i)
      {
        let form = document.forms[`edu${i}`];
        return (form["school_name"].value != "" &&
                form["grad_date"].value   != "" &&
                form["description"].value != "" &&
                form["location"].value    != "") ||
               (form["school_name"].value == "" &&
                form["grad_date"].value   == "" &&
                form["description"].value == "" &&
                form["location"].value    == "" );
      }

      function validate_exp_form(i)
      {
        let form = document.forms[`exp${i}`];
        let valid =
               (form["job_title"].value      != "" &&
                form["exp_start_date"].value != "" &&
                form["exp_end_date"].value   != "" &&
                form["description"].value    != "" &&
                form["location"].value       != "" &&
                form["company"].value       != "") ||
               (form["job_title"].value      == "" &&
                form["exp_start_date"].value == "" &&
                form["exp_end_date"].value   == "" &&
                form["description"].value    == "" &&
                form["location"].value       == "" &&
                form["company"].value       == "") ;
        if (form["exp_start_date"].value > form["exp_end_date"].value) {
          alert("The start date of your experience has to be earlier than the end date.");
          valid = false;
        }
        return valid;
      }

      //------------------ submit function ----------------------
      function submit()
      {
        if (!validate_info_form()) {
          alert("Every field from the basic information section has to be filled");
          return;
        }
        var resume = {
          firstName: document.forms["info"]["fname"].value,
          lastName: document.forms["info"]["lname"].value,
          address: document.forms["info"]["addr"].value,
          phone: document.forms["info"]["phone"].value,
          email: document.forms["info"]["email"].value,
          linkedin: document.forms["info"]["linkedin"].value,
          description: document.forms["info"]["description"].value,
          educations: [],
          experiences: [],
          skills: [],
          interests: []
        };
        if (!getEducations(resume)) {return;}
        if (!getExperiences(resume)) {return;}
        if (!getSkills(resume)) {return;}
        if (!getInterests(resume)) {return;}

        localStorage.setItem('resume', JSON.stringify(resume));

        alert("Your resume has been built! Please go to \"View Resume\" page to see your resume!");
      }

      // Note: this function fills in all the fields in the form with data
      //       only for testing purposes. Please remove this function for the
      //       final submission
      function fill_form()
      {
        document.forms["info"]["fname"].value = "James";
        document.forms["info"]["lname"].value = "Smith";
        document.forms["info"]["addr"].value = "389 Boston Ave.";
        document.forms["info"]["phone"].value = "654-123-987";
        document.forms["info"]["email"].value = "test@example.com";
        document.forms["info"]["linkedin"].value = "linkedin.com/in/james-smith12353/";
        document.forms["info"]["description"].value = "Hi, this is just a test.";
        document.forms["edu0"]["school_name"].value = "Tufts University";
        document.forms["edu0"]["grad_date"].value = "2023-05-20";
        document.forms["edu0"]["description"].value = "A Tufts Student";
        document.forms["edu0"]["location"].value = "Medford, MA";
        document.forms["exp0"]["job_title"].value = "Software Engineer";
        document.forms["exp0"]["company"].value = "FaceBook";
        document.forms["exp0"]["exp_start_date"].value = "2019-01-01";
        document.forms["exp0"]["exp_end_date"].value = "2020-06-01";
        document.forms["exp0"]["description"].value = "Worked as a SE";
        document.forms["exp0"]["location"].value = "Palo Alto, CA";
        document.getElementById("skill0").value = "Java";
        document.getElementById("interest0").value = "Reading";
      }
    </script>

    <form name="info">
      <p>Basic information section:</p>
      <label for="fname">First Name: </label>
      <input type="text" id="fname" name="fname" required><br/><br/>
      <label for="lname">Last Name: </label>
      <input type="text" id="lname" name="lname" ><br/><br/>
      <label for="addr">Address: </label>
      <input type="text" id="addr" name="addr"><br/><br/>
      <label for="phone">Phone: </label>
      <input type="text" id="phone" name="phone"><br/><br/>
      <label for="email">Email: </label>
      <input type="text" id="email" name="email"><br/><br/>
      <label for="linkedin">LinkedIn: </label>
      <input type="text" id="linkedin" name="linkedin"><br/><br/>
      <label for="description">Description: </label>
      <input type="text" id="description" name="description"><br/><br/>
    </form><br/><br/>

    <input type="button" id="add_edu" value="Add Education"/><br/><br/>
    <div id="edu"><p>Education section:</p></div><br/><br/>

    <input type="button" id="add_exp" value="Add Work Experience"/><br/>
    <div id="exp"><p>Work Experience section:</p></div><br/><br/>

    <input type="button" id="add_skill" value="Add Skills"/><br/>
    <div id="skill"><p>Skills section:</p></div><br/><br/>

    <input type="button" id="add_interest" value="Add Interest"/><br/>
    <div id="interest"><p>Interests section:</p></div><br/><br/>

    <input type="button" id="submit" value="Done"/>
    <br/>
    <br/>
  </body>
</html>
